<html>
    <head>
        <title>Planets</title>
        <style>
            canvas { width: 100%; height: 100% }
            body{
                background-image: url('stars2.jpg');
            }
        </style>

    </head>
    <body>
        <script src="three.min.js"></script>
        <script>

            function buildScene(){
                var scene = new THREE.Scene();
                var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
                var renderer = new THREE.WebGLRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);
                camera.position.z = 400;
                return [scene, renderer, camera]
            }
            
            function aPlanet(radius, image, distFromSun, angleOfRot){
                this.radius = radius;
                this.image = image;
                this.distFromSun = distFromSun;
                this.angleOfRot = angleOfRot;
                //this angle of rotation will not update on each call of the render function
                this.ANGLEofROT = angleOfRot;
                this.axis = new THREE.Vector3(0.5, 1, 0.1)
                this.rot_mtx = new THREE.Matrix4;

                this.rotFunction = function(){
                    this.rot_mtx.makeRotationAxis(this.axis, this.ANGLEofROT);
                    return this.rot_mtx;
                }
            }

            //make a planet or sun
            function buildPlanet(aPlanet){
                var geometry = new THREE.SphereGeometry(aPlanet.radius, 16, 16);
                var texture = new THREE.ImageUtils.loadTexture(aPlanet.image);
                var material = new THREE.MeshBasicMaterial({map: texture});
                var planetGeom = new THREE.Mesh(geometry, material);
                scene.add(planetGeom);
                return planetGeom
            }

            function setPosition(planetGeom, aPlanet){
                //set the red planet to a start position 

                planetGeom.position.x = aPlanet.distFromSun;
                planetGeom.position.y = aPlanet.distFromSun*-0.5;
                planetGeom.position.z = 0;
            }

            function orbitPlanet(aPlanet){
                x_direction = aPlanet.distFromSun*Math.cos(aPlanet.angleOfRot)*0.8945 + aPlanet.distFromSun*Math.sin(aPlanet.angleOfRot)*-0.412;
                y_direction = aPlanet.distFromSun*Math.cos(aPlanet.angleOfRot)*-0.472 + aPlanet.distFromSun*Math.sin(aPlanet.angleOfRot)*-0.0799;
                z_direction = aPlanet.distFromSun*Math.cos(aPlanet.angleOfRot)*0 + aPlanet.distFromSun*Math.sin(aPlanet.angleOfRot)*1.009;
                return [x_direction, y_direction, z_direction];
            }


            //this creates a loop that runs every 60th of a sec
            function render(){
                
                //spin each planet
                mySunGeom.applyMatrix(mySun.rotFunction());
                planetGeom.applyMatrix(planet.rotFunction());
                bPlanetGeom.applyMatrix(bPlanet.rotFunction());

                //orbit each planet
                planet.angleOfRot += 0.01;
                directions = orbitPlanet(planet);
                planetGeom.position.x = directions[0];
                planetGeom.position.y = directions[1];
                planetGeom.position.z = directions[2];

                bPlanet.angleOfRot += 0.005;
                directions = orbitPlanet(bPlanet);
                bPlanetGeom.position.x = directions[0];
                bPlanetGeom.position.y = directions[1];
                bPlanetGeom.position.z = directions[2];
            
                renderer.render(scene, camera);

                requestAnimationFrame(render);
            }
            
            /////////////////////////////////////////
            //build scene
            sceneRendererCamera = buildScene();
            var scene = sceneRendererCamera[0];
            var renderer = sceneRendererCamera[1];
            var camera = sceneRendererCamera[2];

            //aPlanet(radius, image, distFromSun, angleOfRot)
            sunImage = "sun.png";
            sunAngle = 0.001;
            var mySun = new aPlanet(80, sunImage, 0, sunAngle);
            var mySunGeom = buildPlanet(mySun);

            planetImage = "planet.jpg";
            redAngle = 0.01;
            var planet = new aPlanet(10, planetImage, 100, redAngle);
            var planetGeom = buildPlanet(planet);
            
            bPlanetImage = "bplanet.jpg";
            blueAngle = 0.005;
            var bPlanet = new aPlanet(30, bPlanetImage, 200, blueAngle);
            var bPlanetGeom = buildPlanet(bPlanet);


            //make rotation matrices
            var axis = new THREE.Vector3(0.5, 1, 0.1)

            // sunRotationMatrix = rotatePlanetMatrix(mySun);
            // redRotationMatrix = rotatePlanetMatrix(planet);
            // blueRotationMatrix = rotatePlanetMatrix(bPlanet);

            //set initial planets 
            setPosition(planetGeom, planet);
            setPosition(bPlanetGeom, bPlanet);

            render();

        </script>
    </body>
</html>